/* this is for partial correlation code. */
Data Junk;
Input x1 x2 y;
datalines;
464912 	828500 	2650000 
320988 	650000 	2600000 
190000 	425700 	2546000 
152941 	151420 	260000 
209000 	336000 	1358500 
608696 	1256700 2800000 
193548 	370700 	1200000 
247581 	416700 	1535000 
176000 	258100 	968000 
326087 	509400 	1500000 
67568 	625000 	3250000 
821633 	1710000 4026000 
136364 	149000 	600000 
120361 	303950 	999000 
243243 	124000 	1800000 
344207 	386000 	2822500 
148462 	117900 	193000 
170833 	86000 	615000 
276596 	320000 	1300000 
211628 	264600 	910000 
179630 	162000 	970000 
170513 	205000 	1330000 
656250 	1465000 	5250000 
148958 	200400 	715000 
487805 	455000 	2000000 
463044 	594000 	2130000 
65789 	108000 	250000 
285714 	385000 	1400000 
119753 	445500 	970000 
120000 	445400 	1500000 
257143 	441000 	1800000 
181202 	421600 	2337500 
224242 	276400 	740000 
418605 	868050 	1800000 
256757 	686850 	1900000 
122917 	90000 	295000 
185897 	247500 	725000 
377049 	1330500 2300000 
268919 	286680 	995000 
279546 	385770 	1230000 
298508 	499500 	2000000 
134340 	1388700 3560000 
818868 	1254750 4340000 
181667 	305850 	327000 
500000 	583900 	2200000 
330540 	660700 	1851025 
86869 	354150 	860000 
208085 	242190 	978000 
161017 	352000 	950000 
333333 	861000 	1200000 
178361 	411750 	1088000 
143590 	159600 	560000 
397500 	888750 	2385000 
348214 	764900 	975000 
260417 	452000 	1250000 
163182 	265050 	359000 
240385 	2881500 5000000 
259434 	430900 	1375000 
725000 	1270350 4350000 
875000 	1360200 4200000 
71848 	204750 	661000 
856000 	1440630 4280000 
242308 	268150 	945000 
305333 	486000 	916000 
514063 	1027900 3290000 
307432 	416520 	2275000 
100000 	133230 	140000 
485714 	795690 	1700000 
265000 	222210 	530000 
;				
	
proc reg ; 					*Step 1;
	title 'Regression of y on x1';	*regress y on x1 and save residuals;
	model y=x1;
	output out=res1 r=res_yx1;

proc reg noprint;					*Step 2;
	title 'Regression of x2 on x1'; 	*regress x2 on x1 and save residuals;
	model x2=x1;
	output out=res2 r=res_x2x1;
		
proc corr nosimple; 		*Step 3, the "nosimple" option stops simple summary stats;
title 'Correlation of res_yx1 on res_x2x1';
var res_yx1 res_x2x1; 			*	produces the coef of x2 "after presence of x1 has been swept out of y and x2";

proc corr nosimple;							*Step 4;
title 'Partial Correlation of y and x2 given x1';
var y x2;					
partial x1;


proc reg;
model y=x2 x1 / pcorr2; /*this option asks for the partial R-sq in both directions: 
			         for y&x1 conditional on x2, and y&x2 conditional on x1 */

Data RegPlot;
Input Price GI AS;
GI_AS = GI*AS; 			* The interaction terms is computed here.;
SqGI = GI*GI;
SqAS = AS*AS;
Datalines;
2650000	464912	828500
2600000	320988	650000
2546000	190000	425700
260000	152941	151420
1358500	209000	336000
2800000	608696	1256700
1200000	193548	370700
1535000	247581	416700
968000	176000	258100
1500000	326087	509400
3250000	67568	625000
4026000	821633	1710000
600000	136364	149000
999000	120361	303950
1800000	243243	124000
2822500	344207	386000
193000	148462	117900
615000	170833	86000
1300000	276596	320000
910000	211628	264600
970000	179630	162000
1330000	170513	205000
5250000	656250	1465000
715000	148958	200400
2000000	487805	455000
2130000	463044	594000
250000	65789	108000
1400000	285714	385000
970000	119753	445500
1500000	120000	445400
1800000	257143	441000
2337500	181202	421600
740000	224242	276400
1800000	418605	868050
1900000	256757	686850
295000	122917	90000
725000	185897	247500
2300000	377049	1330500
995000	268919	286680
1230000	279546	385770
2000000	298508	499500
3560000	134340	1388700
4340000	818868	1254750
327000	181667	305850
2200000	500000	583900
1851025	330540	660700
860000	86869	354150
978000	208085	242190
950000	161017	352000
1200000	333333	861000
1088000	178361	411750
560000	143590	159600
2385000	397500	888750
975000	348214	764900
1250000	260417	452000
359000	163182	265050
5000000	240385	2881500
1375000	259434	430900
4350000	725000	1270350
4200000	875000	1360200
661000	71848	204750
4280000	856000	1440630
945000	242308	268150
916000	305333	486000
3290000	514063	1027900
2275000	307432	416520
140000	100000	133230
1700000	485714	795690
530000	265000	222210
;

proc sgscatter data=Regplot;
matrix Price GI AS GI_AS; 
run;	

proc reg; 									
title 'Regression Diagostics';
model Price = GI AS GI_AS ; 				* note that GI_AS has been added;
run; 

proc sgscatter;
matrix Price GI AS SqGI SqAS GI_AS; 
run;

proc reg; 									
title 'Regression Diagostics';
model Price = GI AS SqGI SqAS GI_AS ; 				* Five regressors;
output out=junk H=leverage;
run;
